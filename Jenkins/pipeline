pipeline {
    agent any
    environment {
        AWS_ACCESS_KEY_ID     = 'AKIAYQNJSPFOXZM67LOQ'
        AWS_SECRET_ACCESS_KEY = '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'
        AWS_DEFAULT_REGION    = 'ap-south-1'
    }
    stages {
        stage('Launch EC2 Instance') {
            steps {
                sh '''
aws ec2 run-instances \
  --image-id ami-02b8269d5e85954ef \
  --instance-type t2.micro \
  --key-name faisal \
  --security-group-ids sg-06becf8eeaf3e7dd9 \
  --subnet-id subnet-042c03481f1557a8f \
  --user-data '#!/bin/bash
sudo su
apt update -y
apt install -y apache2 unzip wget
systemctl start apache2
systemctl enable apache2

wget --no-check-certificate "https://drive.google.com/uc?export=download&id=1H9RaSCEx1pvBupx2qcDvcN1E7YLdcl2B" -O neogym.zip
unzip -o neogym.zip
cp -r neogym-html/* /var/www/html/
systemctl restart apache2
' \
  --tag-specifications "ResourceType=instance,Tags=[{Key=Name,Value=website}]"
                '''
            }
        }
    }
}
